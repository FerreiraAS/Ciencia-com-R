# **Análise causal** {#analise-causal}

<br>

## Causalidade

<br>

### O que é análise causal?

-   Análise causal é usada para explicar a relação entre causa e efeito em um conjunto de dados, respondendo a perguntas do tipo "por quê?".[@gerring2012]

-   Análise causal implica em contrafactual, no sentido de que a análise causal é baseada na comparação entre o que realmente aconteceu e o que teria acontecido se uma ou mais variáveis tivessem sido diferentes.[@gerring2012]

<br>

### Quais os dois grandes tipos de causalidade?

-   Baseada em experiência: conhecimento empírico, muitas vezes sem compreensão dos mecanismos. Estatística tem papel central na causalidade baseada em experiência.[@aalen2007]

-   Mecanicista: busca entender processos internos e mecanismos. Estatística tem seu papel ainda limitado, mas crescente, especialmente em sistemas complexos.[@aalen2007]

<br>

## Abordagens filosóficas e estatísticas da causalidade

<br>

### O que é realidade causal?

-   A estatística assume tanto a presença do acaso quanto de causalidade. Entretanto, a natureza de cada um (se essencial ou apenas reflexo de ignorância) é raramente debatida.[@aalen2007]

<br>

### Por que estatísticos historicamente evitaram falar em causalidade?

-   Pearson e Fisher defenderam que estatística trata apenas de associação, não de causalidade, o que gerou cautela excessiva e paralisou avanços em áreas como economia e ciências sociais. [@aalen2007]

-   Autores como Judea Pearl, Robins e Rubin trouxeram definições mais precisas, especialmente via modelos contrafactuais.[@aalen2007]

-   O uso de ensaios clínicos randomizados consolidou o papel da estatística em inferência causal aplicada.[@aalen2007]

<br>

## Ilusões de causalidade

<br>

### O que são ilusões de causalidade?

-   Ocorrem quando acreditamos que há uma relação causal entre dois eventos que, na realidade, são independentes. São comuns em superstições, pseudociências e crenças do cotidiano.[@matute2015]

<br>

### Quais fatores favorecem a ilusão?

-   Alta frequência do desfecho: quando o resultado ocorre frequentemente por acaso, as pessoas superestimam a eficácia da causa (ex.: melhora espontânea de sintomas atribuída a um tratamento).[@matute2015]

-   Alta frequência da causa: quanto mais vezes um comportamento ou tratamento é aplicado, mais coincidências com o desfecho ocorrem, aumentando a crença no efeito.[@matute2015]

-   Coincidências causa–desfecho: damos peso desproporcional a casos em que causa e efeito ocorrem juntos, mesmo que sejam apenas coincidências.[@matute2015]

<br>

### Como reduzir ilusões de causalidade?

-   Ensinar princípios de controle científico, observando casos em que a causa está ausente (comparação necessária para detectar ausência de relação).[@matute2015]

-   Diminuir a frequência da causa (ex.: reduzir uso de um “remédio ineficaz” ajuda a perceber que o resultado ocorre independentemente).[@matute2015]

-   Instruções explícitas para testar hipóteses: orientar a aplicar a causa em apenas 50% das vezes favorece a detecção correta da ausência de efeito.[@matute2015]

-   Promover educação científica prática, mostrando às pessoas como seus próprios julgamentos podem ser enviesados e oferecendo ferramentas para avaliação crítica.[@matute2015]

<br>

## Inferência causal em estudos observacionais

<br>

### Como diferenciar associação de causalidade?

-   Associação descreve que duas variáveis variam juntas, mas não garante que uma afete a outra.[@vickers2023]

-   Causalidade exige evidências (diretas ou indiretas) de que modificar a variável de exposição altera o desfecho.[@vickers2023]

<br>

### Quais critérios ajudam a sustentar inferência causal?

-   Existência de um mecanismo plausível.[@vickers2023]

-   Controle adequado de confundidores (medidos e não medidos).[@vickers2023]

-   Consistência com literatura prévia e plausibilidade do tamanho do efeito.[@vickers2023]

-   Avaliação de alternativas explicativas (ex.: viés de seleção, mediadores não controlados).[@vickers2023]

<br>

### Qual o papel dos caminhos causais (DAGs)?

-   Ajudam a identificar quais variáveis precisam ser medidas e ajustadas.[@vickers2023]

-   Evitam ajustes indevidos (ex.: em colisores), que podem introduzir viés.[@vickers2023]

<br>

### Como lidar com confundimento residual?

-   Reconhecer que modelos multivariados e escores de propensão não eliminam completamente o confundimento.[@vickers2023]

-   Comparar características basais entre grupos para identificar diferenças persistentes.[@vickers2023]

-   Considerar análises de sensibilidade, mas com cautela na interpretação.[@vickers2023]

<br>

## Critérios de Hill para inferência causal

<br>

### Quais são os nove critérios?

-   Temporalidade: A exposição deve preceder o desfecho. Único critério considerado essencial por Hill.[@hill1965]

-   Força da associação: Associações mais fortes são mais prováveis de refletir causalidade.[@hill1965]

-   Consistência: A associação é observada em diferentes estudos, populações e contextos.[@hill1965]

-   Especificidade: Uma exposição leva a um efeito específico (embora nem sempre aplicável).[@hill1965]

-   Gradiente biológico (dose–resposta): Aumentos na exposição acompanham aumentos no risco.[@hill1965]

-   Plausibilidade biológica: Compatibilidade com o conhecimento científico da época.[@hill1965]

-   Coerência: A associação não deve contradizer a história natural ou biologia da doença.[@hill1965]

-   Evidência experimental: Reduções na exposição devem reduzir o risco observado.[@hill1965]

-   Analogia: Comparação com relações causais já conhecidas.[@hill1965]

<br>

### Hill propôs um checklist rígido?

-   Nenhum critério, isoladamente, prova ou refuta causalidade. Devem ser usados como guias para reflexão científica, não como requisitos obrigatórios.[@hill1965]

<br>

## Críticas contemporâneas aos critérios de Hill

<br>

### Qual critério é indispensável?

-   A temporalidade: a exposição deve preceder o desfecho. Mesmo assim, observar uma ordem temporal inversa apenas invalida a hipótese em casos específicos, não em todos.[@rothman2005]

<br>

### A força da associação garante causalidade?

-   Não. Associações fortes podem ainda ser não-causais e associações fracas podem ser causais.[@rothman2005]

<br>

### A consistência é indispensável?

-   Não. A ausência de consistência não elimina causalidade, pois alguns efeitos só se manifestam em condições específicas (ex.: transfusão só causa HIV se o vírus estiver presente).[@rothman2005]

-   A consistência ajuda apenas a afastar a hipótese de viés ou erro em um estudo isolado:contentReference.[@rothman2005]

<br>

### O critério da especificidade é válido?

-   Não. É considerado um critério inválido e enganoso. Uma causa pode ter múltiplos efeitos (tabagismo → vários desfechos) e um efeito pode ter múltiplas causas.[@rothman2005]

<br>

### O gradiente biológico (dose–resposta) é confiável?

-   Nem sempre. Pode ser distorcido por confundimento. A ausência de gradiente não invalida a causalidade.[@rothman2005]

<br>

### A plausibilidade e a coerência são objetivas?

-   Não. Ambas são fortemente dependentes do conhecimento científico da época. O que parecia implausível no passado depois se confirmou como verdadeiro.[@rothman2005]

<br>

### Evidência experimental é decisiva?

-   Pode ser útil, mas raramente está disponível em epidemiologia. Mesmo quando disponível, pode ter explicações alternativas.[@rothman2005]

<br>

### Analogia é útil?

-   Tem pouco valor. Analogias podem sempre ser inventadas e, na prática, funcionam mais como fonte de hipóteses do que como prova.[@rothman2005]

<br>

## Visão atual sobre os critérios de Hill

<br>

### Como os critérios de Hill foram revisitados?

-   Estudos recentes propõem integrá-los a três abordagens modernas: DAG (destacam estrutura causal e confundimento), modelos de causa suficiente (enfatizam multifatorialidade) e GRADE (orienta sobre a certeza da evidência em corpos de estudos).[@shimonovich2020]

<br>

### Quais mudanças na interpretação?

-   Temporalidade e experimentos: seguem centrais, mas analisados com mais sofisticação.[@shimonovich2020]

-   Força da associação: relevante, mas não garante causalidade (pode haver confundimento).[@shimonovich2020]

-   Consistência: pensada como transportabilidade entre populações.[@shimonovich2020]

-   Especificidade: pouco útil hoje; substituída por falsificação (controles negativos).[@shimonovich2020]

-   Dose–resposta: pode ser espúria, cautela é necessária.[@shimonovich2020]

-   Coerência e analogia: utilidade limitada.[@shimonovich2020]

<br>

## Linguagem causal em estudos observacionais

<br>

### Quais são as principais recomendações para relatar causalidade?

-   Usar termos causais de forma explícita e criteriosa (“causa”, “efeito”, “reduzir”, “aumentar”), evitando expressões ambíguas como “fator de risco”.[@vickers2023]

-   Contextualizar a causalidade em termos práticos, explicando por que identificar a causa é relevante para intervenções.[@vickers2023]

-   Declarar claramente na introdução se existe hipótese causal, justificando quando não houver.[@vickers2023]

-   Descrever caminhos causais (mediadores, confundidores, colisores) em texto claro ou com diagramas.[@vickers2023]

-   Justificar a seleção de covariáveis com base nas relações causais previstas.[@vickers2023]

-   Avaliar o controle de confundimento, reconhecendo limitações e possível confundimento residual.[@vickers2023]

-   Discutir as inferências causais considerando estimativas, vieses e plausibilidade biológica.[@vickers2023]

-   Indicar recomendações específicas para pesquisas futuras ou prática clínica baseadas nas conclusões causais.[@vickers2023]

<br>

## Efeitos diretos e indiretos

<br>

### Como distinguir efeitos diretos de indiretos?

-   Um efeito direto ocorre quando uma variável influencia outra sem mediação.[@aalen2007]

-   Um efeito indireto acontece quando a influência é mediada por variáveis intermediárias.[@aalen2007]

<br>

## O papel do tempo e a causalidade dinâmica

<br>

### O que é causalidade de Granger?

-   É um conceito estatístico que analisa como processos passados influenciam o futuro, indo além da simples associação.[@aalen2007]

-   Permite identificar relações direcionais entre processos ao longo do tempo (ex.: cérebro controlando contrações musculares).[@aalen2007]

-   A estatística, nesse contexto, busca "olhar dentro da caixa", aproximando-se de uma visão mecanicista.[@aalen2007]

<br>

### Por que o tempo é essencial na análise causal?

-   Processos causais não ocorrem de forma estática: efeitos diretos e indiretos se acumulam em cadeias temporais.[@aalen2007]

-   Modelos tradicionais (ex.: regressões estáticas ou DAGs sem tempo) podem falhar em capturar a dinâmica.[@aalen2007]

-   A integração de séries temporais e processos estocásticos é fundamental para compreender mecanismos.[@aalen2007]

<br>

## Diagrama acíclico direcionado (DAG)

<br>

### O que são DAGs?

-   DAGs são representações gráficas de relações causais entre variáveis, usando nós (variáveis) e arestas direcionadas (relações causais).[@REF]

-   DAGs ajudam a identificar confundidores, mediadores e colisores, orientando a seleção de variáveis para ajuste em análises estatísticas.[@REF]

-   DAGs são acíclicos, ou seja, não permitem ciclos ou loops, refletindo a natureza unidirecional das relações causais.[@REF]

<br>

### Quais são os padrões causais básicos?

-   Independência: duas variáveis não têm relação causal direta ou indireta.[@REF]

-   Cadeia: uma variável causa outra, que por sua vez causa uma terceira (X → M → Y).[@REF]

-   Garfo: uma variável causa duas outras (X ← Z → Y), onde Z é um confundidor.[@REF]

-   Colisor: duas variáveis causam uma terceira (X → Z ← Y), onde Z é um colisor.[@REF]

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *dagitty*[@dagitty] fornece a função [*dagitty*](https://cran.r-project.org/web/packages/dagitty/index.html) para criar um objeto grafo a partir de uma descrição textual.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *ggdag*[@ggdag] fornece a função [*ggdag*](https://www.rdocumentation.org/packages/ggdag/versions/0.2.10/topics/ggdag) para criar figuras de grafos.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *performance*[@performance] fornece a função [*check_dag*](https://easystats.github.io/performance/reference/check_dag.html) para criar, verificar e visualizar os modelos em grafos.
:::

<br>

```{r dag, include = TRUE, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Padrões causais básicos: independência, cadeia, garfo e colisor.", out.width = "90%"}
# ---------- Funções auxiliares ----------
.build_nodes_df <- function(dag, panel_label){
  coords <- dagitty::coordinates(dag)
  nms <- union(names(coords$x), names(coords$y))
  x <- unname(coords$x[nms]); names(x) <- NULL
  y <- unname(coords$y[nms]); names(y) <- NULL
  data.frame(
    name  = nms, x = as.numeric(x), y = as.numeric(y),
    panel = panel_label, stringsAsFactors = FALSE
  )
}

.build_edges_df <- function(dag, nodes_df){
  ed <- dagitty::edges(dag)
  if(nrow(ed) == 0L) return(data.frame())
  x_of <- function(nm) nodes_df$x[match(nm, nodes_df$name)]
  y_of <- function(nm) nodes_df$y[match(nm, nodes_df$name)]
  data.frame(
    x     = x_of(ed$v), y    = y_of(ed$v),
    xend  = x_of(ed$w), yend = y_of(ed$w),
    panel = nodes_df$panel[1], stringsAsFactors = FALSE
  )
}

# Encurtar arestas para não invadir os nós
trim_edges_to_node_border <- function(edges, node_r = 0.085){
  if(nrow(edges) == 0L) return(edges)
  dx  <- edges$xend - edges$x
  dy  <- edges$yend - edges$y
  L   <- sqrt(dx*dx + dy*dy)
  ux  <- dx / L
  uy  <- dy / L
  # recua na origem e no destino
  edges$x    <- edges$x    + ux * node_r
  edges$y    <- edges$y    + uy * node_r
  edges$xend <- edges$xend - ux * node_r
  edges$yend <- edges$yend - uy * node_r
  edges
}

# ---------- DAGs ----------
dag_ind <- dagitty::dagitty("dag { X Y }")
dagitty::coordinates(dag_ind) <- list(x = c(X=0, Y=1), y = c(X=0, Y=0))

dag_chain <- dagitty::dagitty("dag { X -> M -> Y }")
dagitty::coordinates(dag_chain) <- list(x = c(X=0, M=0.5, Y=1), y = c(X=0, M=0, Y=0))

dag_fork <- dagitty::dagitty("dag { X <- Z -> Y }")
dagitty::coordinates(dag_fork) <- list(x = c(X=0, Z=0.5, Y=1), y = c(X=0, Z=0, Y=0))

dag_coll <- dagitty::dagitty("dag { X -> Z <- Y }")
dagitty::coordinates(dag_coll) <- list(x = c(X=0, Z=0.5, Y=1), y = c(X=0, Z=0, Y=0))

# ---------- Data frames ----------
nodes_all <- rbind(
  .build_nodes_df(dag_ind,   "1) Independência"),
  .build_nodes_df(dag_chain, "2) Cadeia (X → M → Y)"),
  .build_nodes_df(dag_fork,  "3) Garfo (X ← Z → Y)"),
  .build_nodes_df(dag_coll,  "4) Colisor (X → Z ← Y)")
)

edges_all <- rbind(
  .build_edges_df(dag_ind,   subset(nodes_all, panel == "1) Independência")),
  .build_edges_df(dag_chain, subset(nodes_all, panel == "2) Cadeia (X → M → Y)")),
  .build_edges_df(dag_fork,  subset(nodes_all, panel == "3) Garfo (X ← Z → Y)")),
  .build_edges_df(dag_coll,  subset(nodes_all, panel == "4) Colisor (X → Z ← Y)"))
)

# *** Ajuste importante: encurtar arestas ***
edges_all <- trim_edges_to_node_border(edges_all, node_r = 0.085)

# ---------- Plot ----------
p <- ggplot2::ggplot() +
  # Arestas com setas visíveis
  ggplot2::geom_segment(
    data = edges_all,
    mapping = ggplot2::aes(x = x, y = y, xend = xend, yend = yend),
    arrow = grid::arrow(length = grid::unit(0.25, "in"), ends = "last", type = "closed"),
    linewidth = 1
  ) +
  # Nós grandes (círculo branco com contorno)
  ggplot2::geom_point(
    data = nodes_all,
    mapping = ggplot2::aes(x = x, y = y),
    shape = 21, fill = "white", color = "black",
    stroke = 1.6, size = 14
  ) +
  # Letras dentro dos círculos
  ggplot2::geom_text(
    data = nodes_all,
    mapping = ggplot2::aes(x = x, y = y, label = name),
    size = 6, fontface = "bold", vjust = 0.35, hjust = 0.5
  ) +
  ggdag::theme_dag() +
  ggplot2::facet_wrap(~ panel, ncol = 2) +
  ggplot2::theme(
    plot.title = ggplot2::element_text(hjust = 0.5, size = 14),
    panel.spacing = grid::unit(5, "lines"),
    plot.margin = grid::unit(c(0.5, 0.5, 0.5, 0.5), "cm")
  ) +
  ggplot2::coord_cartesian(clip = "off")

print(p)
```

<br>

```{r, echo=FALSE, warning=FALSE, results='asis', eval=knitr::is_html_output()}
cat(readLines("citation.html"), sep = "\n")
```

<br>
