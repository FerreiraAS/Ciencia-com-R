# **Regressão**

<br>

## Análise de regressão

<br>

### O que é regressão?

-   Regressão refere-se a uma equação matemática que permite que uma ou mais variável(is) de desfecho (dependentes) seja(m) prevista(s) a partir de uma ou mais variável(is) independente(s). A regressão implica em uma direção de efeito, mas não garante causalidade.[@greenhalgh1997a]

-   Para estimar os efeitos imparciais de um fator de exposição primária sobre uma variável de desfecho, frequentemente constroem-se modelos estatísticos de regressão.[@bandoli2018]

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *modelsummary*[@modelsummary] fornece as funções [*modelsummary*](https://www.rdocumentation.org/packages/modelsummary/versions/1.4.1/topics/modelsummary) e [*modelplot*](https://www.rdocumentation.org/packages/modelsummary/versions/1.4.1/topics/modelplot) para gerar tabelas e gráficos de coeficientes de regressão.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *gtsummary*[@gtsummary-2] fornece a função [*tbl_regression*](https://www.rdocumentation.org/packages/gtsummary/versions/1.6.3/topics/tbl_regression) para construção da 'Tabela 2' com dados do modelo de regressão.
:::

<br>

### Quais são os algoritmos de regressão?

- Linear.[REF]

- Polinomial.[REF]

- Ridge.[REF]

- Lasso.[REF]

<br>

### O que são análises de regressão simples?

-   A análise de regressão simples consiste em modelos estatísticos com 1 variável dependente (desfecho) e 1 variável independente (preditor).[@Hidalgo2013]

<br>

### O que são análises de regressão multivariável?

-   A análise multivariável (ou múltiplo) consiste em modelos estatísticos com 1 variável dependente (desfecho) e duas ou mais variáveis independentes.[@Hidalgo2013]

<br>

### O que são análises de regressão multivariada?

-   A análise multivariada consiste em modelos estatísticos com 2 ou mais variáveis dependente (desfechos) e duas ou mais variáveis independentes.[@Hidalgo2013]

<br>

### O que são análises de regressão linear?

- .[REF]

<br>

### O que são análises de regressão não-linear?

- .[REF]

<br>

### O que são análises de regressão logística?

- .[REF]

<br>

## Preparação de variáveis para regressão

<br>

### Como preparar as variáveis categóricas para análise de regressão?

-   Variáveis fictícias (*dummy*) compreendem variáveis criadas para introduzir, nos modelos de regressão, informações contidas em outras variáveis que não podem ser medidas em escala numérica.[@suits1957]

-   Variáveis categóricas nominais, com 2 ou mais níveis, devem ser subdivididas em variáveis fictícias dicotômicas para ser usada em modelos de regressão.[@Healy1995]

-   Cada nível da variável categórica nominal será convertido em uma nova variável fictícias dicotômica, tal que a nova variável dicotômica assume valor 1 para a presença do nível correspondente e 0 em qualquer outro caso.[@Healy1995]

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *fastDummies*[@fastDummies] fornece a função [*dummy_cols*](https://www.rdocumentation.org/packages/fastDummies/versions/1.7.3/topics/dummy_columns) para preparar as variáveis categóricas fictícias para análise de regressão.
:::

<br>

## Redução de dimensionalidade para regressão

<br>

### Correlação bivariada pode ser usada para seleção de variáveis em modelos de regressão multivariável?

-   Seleção bivariada de variáveis - isto é, aplicação de testes de correlação em pares de variáveis candidatas e variável de desfecho afim de selecionar quais serão incluídas no modelo multivariável - é um dos erros mais comuns na literatura.[@Dales1978; @Sun1996; @heinze2016]

-   A seleção bivariada de variáveis torna o modelo mais suscetível a otimismo no ajuste se as variáveis de confundimento não são adequadamente controladas.[@Dales1978; @Sun1996]

<br>

### Variáveis sem significância estatística devem ser excluídas do modelo final?

-   Eliminar uma variável de um modelo significa anular o seu coeficiente de regressão ($\beta = 0$), mesmo que o valor estimado pelos dados seja outro. Desta forma, os resultados se afasTAM de uma solução de máxima verossimilhança (que tem fundamento teórico) e o modelo resultante é intencionalmente subótimo.[@heinze2016]

-   Os coeficientes de regressão geralmente dependem do conjunto de variáveis do modelo e, portanto, podem mudam de valor ("mudança na estimativa" positiva ou negativa) se uma (ou mais) variável(is) for(em) eliminada(s) do modelo.[@heinze2016]

<br>

### Por que métodos de regressão gradual não são recomendados para seleção de variáveis em modelos de regressão multivariável?

-   Métodos diferentes de regressão gradual podem produzir diferentes seleções de variáveis de um mesmo banco de dados.[@Healy1995]

-   Nenhum método de regressão gradual garante a seleção ótima de variáveis de um banco de dados.[@Healy1995]

-   As regras de término da regressão baseadas em P-valor tendem a ser arbitrárias.[@Healy1995]

<br>

### O que pode ser feito para reduzir o número de variáveis candidatas em modelos de regressão multivariável?

-   Verifique a existência de multicolinearidade entre as variáveis candidatas.[@Sun1996]

<br>

```{r multicolinearidade, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis", out.width = "100%", fig.cap = "Multicolinearidade entre variáveis candidatas em modelos de regressão multivariável."}
# Set the seed for reproducibility
set.seed(123)

# Generate an independent variable
X1 <- rnorm(100, mean = 50, sd = 10)

# Generate a second variable that is highly correlated with X1
X2 <- 0.8 * X1 + rnorm(100, mean = 0, sd = 5)

# Generate a third variable that is not correlated with X1 or X2
X3 <- rnorm(100, mean = 30, sd = 5)

# Combine the variables into a data frame
data <- data.frame(X1, X2, X3)

# Create the customized grid plot
GGally::ggpairs(
  data, 
  lower = list(continuous = GGally::wrap("smooth", method = "lm")),
  diag = list(continuous = "densityDiag"),
  upper = list(continuous = "cor")
) +
  ggplot2::theme(
    panel.background = ggplot2::element_blank(),
    panel.grid.major = ggplot2::element_blank(),
    panel.grid.minor = ggplot2::element_blank(),
    axis.line = ggplot2::element_line(color = "black")
  )
```

<br>

-   Em caso de uma proporção baixa entre o número de participantes e de variáveis, use o conhecimento prévio da literatura para selecionar um pequeno conjunto de variáveis candidatas.[@Sun1996]

-   Colapse categorias com contagem nula (células com valor igual a 0) de variáveis candidatas.[@Sun1996]

-   Use simulações de dados para identificar qual(is) variável(is) está(ão) causando problemas de convergência do ajuste do modelo.[@Sun1996]

-   A eliminação retroativa tem sido recomendada como a abordagem de regressão gradual mais confiável entre aquelas que podem ser facilmente alcançadas com programas de computador.[@heinze2016]

<br>

## Efeito fixo

<br>

### O que é efeito fixo?

-   .[REF]

<br>

## Efeito aleatório

<br>

### O que é efeito aleatório?

-   .[REF]

<br>

## Efeito principal

<br>

### O que é efeito principal?

-   .[@Bours2023]

<br>

## Efeito de modificação

<br>

### O que é um modificador de efeito?

-   .[@Bours2023]

<br>

### O que é efeito de modificação?

-   .[@Bours2023]

<br>

## Efeito de interação

<br>

### O que é efeito de interação?

-   A interação - representada pelo símbolo \* - é o termo estatístico empregado para representar a heterogeneidade de um determinado efeito.[@Altman1996]

-   .[@Bours2023]

```{r efeito-interacao, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis", fig.fullwidth = TRUE, fig.cap = "Análise de efeito de interação entre grupos de tratamento e tempo. Retas paralelas sugerem ausência de efeito de interação, enquanto retas não paralelas sugerem efeito de interação."}

# Simulate data
set.seed(123)  # For reproducibility
n <- 5  # Number of observations

# Create a data frame with two time points and different offsets
data <- data.frame(
  group = rep(c("A", "B", "B'"), each = n*2),
  time = rep(c(1, 2), each = n),
  response = c(
    5 + rnorm(n, mean = 0, sd = 1),   # Group A at time 1
    15 + rnorm(n, mean = 0, sd = 1),  # Group A at time 2
    10 + rnorm(n, mean = 0, sd = 1),  # Group B' at time 1
    20 + rnorm(n, mean = 0, sd = 1),  # Group B' at time 2
    rnorm(n, mean = 0, sd = 1),  # Group B at time 1
    rnorm(n, mean = 0, sd = 1)   # Group B at time 2
  )
)

# add offset to group B at 2
data$response[data$group == "B'" & data$time == 1] <- data$response[data$group == "B" & data$time == 1]
data$response[data$group == "B'" & data$time == 2] <- data$response[data$group == "B" & data$time == 2] + 5

# Calculate means for plotting
means <- aggregate(response ~ group + time, data, mean)

# Create the plot
ggplot2::ggplot(means, ggplot2::aes(x = time, y = response, color = group, group = group)) +
  ggplot2::geom_line(size = 1) +               # Draw lines for means
  ggplot2::geom_point(size = 3) +              # Add points for means
  ggplot2::scale_x_continuous(breaks = c(1, 2), labels = c("Antes", "Depois")) +
  ggplot2::labs(title = "",
       x = "Tempo",
       y = "Resposta") +
  ggplot2::theme_minimal() +
  ggplot2::scale_color_manual(values = c("black", "black", "gray")) +  # Custom colors
  ggplot2::theme(legend.title = ggplot2::element_blank()) + 
  # minumum theme
  ggplot2::theme(
    panel.grid.major = ggplot2::element_blank(),
    panel.grid.minor = ggplot2::element_blank(),
    panel.background = ggplot2::element_blank(),
    axis.line = ggplot2::element_line(colour = "black")
  ) + 
  # move legent to the top left corner
  ggplot2::theme(legend.position = c(0, 1), legend.justification = c(0, 1)) +
  # annotate plot with "Efeito esperado sem interação"
  ggplot2::annotate("text", x = 2, y = mean(data$response[data$group == "B" & data$time == 2]), label = "Sem efeito de \n interação", size = 3, color = "black", hjust = -0.1, vjust = 0.5) + 
  # annotate plot with "Efeito esperado com interação"
  ggplot2::annotate("text", x = 2, y = mean(data$response[data$group == "B'" & data$time == 2]), label = "Com efeito de \n interação", size = 3, color = "black", hjust = -0.1, vjust = 0.5) + 
  # draw dashed arrow of effect from B' to B at time 2
  ggplot2::geom_segment(ggplot2::aes(x = 2, xend = 2, y = mean(data$response[data$group == "B'" & data$time == 2]), yend = mean(data$response[data$group == "B" & data$time == 2])), arrow = ggplot2::arrow(type = "open", length = ggplot2::unit(0.1, "inches"), ends = "both", angle = 20), color = "black", linetype = "dashed") + 
  # annotate plot with "Efeito de interação"
  ggplot2::annotate("text", x = 2, y = mean(data$response[data$group != "A" & data$time == 2]), label = "Tamanho de efeito \n estimado", size = 3, color = "black", hjust = -0.1, vjust = 0.5) + 
  # augment x axis margins to make room for annotations
  ggplot2::scale_x_continuous(expand = c(0.3, 0.3))
```

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *nlme*[@nlme] fornece a função [*nlme*](https://www.rdocumentation.org/packages/nlme/versions/3.1-163/topics/nlme) para ajustar um modelo de regressão misto não linear.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *mmrm*[@mmrm] fornece a função [*mmrm*](https://rdrr.io/cran/mmrm/man/mmrm.html) para ajuste de um modelo de regressão misto linear.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *emmeans*[@emmeans] fornece a função [*emmeans*](https://www.rdocumentation.org/packages/emmeans/versions/1.8.7/topics/emmeans) para calcular as médias marginais dos fatores e suas combinações de um modelo de regressão misto linear.
:::

<br>

## Efeito de mediação

<br>

### O que é um mediador de efeito?

-   .[@Baron1986]

-   .[@Bours2023]

<br>

### O que é efeito de mediação?

-   .[@Baron1986]

-   .[@Bours2023]

<br>

### O que é efeito direto?

-   .[@Baron1986]

-   .[@Bours2023]

<br>

### O que é efeito indireto?

-   .[@Baron1986]

-   .[@Bours2023]

<br>

### O que é efeito total?

-   .[@Baron1986]

-   .[@Bours2023]

<br>

## Efeitos brutos e padronizados

<br>

### O que é efeito bruto?

-   .[@greenland1986]

-   .[@greenland1991]

<br>

### O que é efeito padronizado?

-   .[@greenland1986]

-   .[@greenland1991]

<br>

## Suposições dos modelos

<br>

### Quais suposições são feitas para modelagem de regressão?

-   .[REF]

<br>

### Como avaliar as suposições do modelo?

-   .[REF]

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *performance*[@performance] fornece a função [*check_model*](https://www.rdocumentation.org/packages/performance/versions/0.10.4/topics/check_model) para analisar a colinearidade entre variáveis, a normalidade da distribuição das variáveis e a heteroscedasticidade.
:::

<br>

## Avaliação de modelos

<br>

### O que é qualidade de ajuste de um modelo?

-   .[REF]

<br>

### Como avaliar a qualidade de ajuste de um modelo?

-   .[REF]

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *performance*[@performance] fornece a função [*model_performance*](https://www.rdocumentation.org/packages/performance/versions/0.10.4/topics/model_performance) para calcular as métricas de ajuste da regressão adequadas ao modelo pré-especificado.
:::

<br>

::: {.infobox .Rlogo data-latex="{images/Rlogo}"}
O pacote *performance*[@performance] fornece a função [*compare_performance*](https://www.rdocumentation.org/packages/performance/versions/0.10.4/topics/compare_performance) para comparar o desempenho e a qualidade do ajuste de diversos modelos de regressão pré-especificados.
:::

<br>
