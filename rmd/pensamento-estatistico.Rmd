# **Pensamento estatístico** {#pensamento-estatistico}

<br>

## Unidade de análise

<br>

### O que é unidade de análise?

-   A unidade de análise (ou unidade experimental) de pesquisas na área de saúde geralmente é o indivíduo.[@Altman1997]

-   A unidade de análise também pode ser a instituição em estudos multicêntricos (ex.: hospitais, clínicas) ou um estudo publicado em meta-análise (ex.: ensaios clínicos).[@Altman1997]

<br>

### Por que identificar a unidade de análise de um estudo?

-   É fundamental identificar corretamente a unidade de análise para evitar inflação do tamanho da amostra (ex.: medidas bilaterais resultando em o dobro de participantes), violações de suposições dos testes de hipótese (ex.: independência entre medidas e/ou unidade de análise) e resultados espúrios em testes de hipótese (ex.: P-valores menores que aqueles observados se a amostra não estivesse inflada).[@Altman1997; @Matthews1990]

<br>

### Que medidas podem ser obtidas da unidade de análise de um estudo?

-   Da unidade de análise podem ser coletadas informações em medidas únicas, repetidas, seriadas ou múltiplas.

<br>

## População

<br>

### O que é população?

-   População --- ou população-alvo --- refere-se ao conjunto completo sobre o qual se pretende obter informações.[@Banerjee2010; @martínez-mesa2016]

-   População é metodologicamente delimitada pelos critérios de inclusão e exclusão do estudo.[@Banerjee2010]

-   Em estudos observacionais, inicialmente as características geográficas e/ou demográficas, por exemplo, definem a população a ser estudada.[@Banerjee2010]

-   Em estudos analíticos, a população é inicialmente definida pelos objetivos da pesquisa e, posteriormente, as observações são realizadas na amostra.[@Banerjee2010]

<br>

### O que é representatividade e por que ela importa?

- Representatividade refere-se ao grau em que uma amostra reflete com fidelidade as características da população de referência.[@martínez-mesa2016]

- Quando a amostra contém menos indivíduos do que o número mínimo necessário, mas mantém a representatividade, a inferência estatística ainda é possível, embora possa haver redução da precisão e/ou do poder estatístico para detectar os efeitos.[@martínez-mesa2016]

- Amostras não representativas comprometem a validade da inferência estatística, mesmo quando o tamanho da amostra atende aos requisitos de poder da análise.[@martínez-mesa2016]

<br>

## Amostra

<br>

### O que é amostra?

-   Amostra é uma parte finita da população do estudo.[@Banerjee2010; @martínez-mesa2016]

-   Em pesquisa científica, utilizam-se dados de uma amostra de participantes (ou outras unidades de análise) para realizar inferências sobre a população.[@Bland2015]

<br>

### Por que usar dados de amostras?

- Estudos com amostras, em vez de censos, são preferíveis por diversas razões, dentre elas: questões éticas; limitações orçamentárias; desafios logísticos; restrição de tempo; e tamanho populacional desconhecido.[@martínez-mesa2016]

-   Dados de uma amostra de tamanho suficiente e características representativas podem ser utilizados para inferência sobre uma população.[@kwak2017]

-   Em geral, amostras de tamanhos maiores possuem médias mais próximas da média populacional e menores variâncias.[@kwak2017]

<br>

## Amostragem

<br>

### O que é amostragem?

- Amostragem é o processo pelo qual se seleciona uma parte de uma população para constituir a amostra que será efetivamente estudada.[@martínez-mesa2016]

<br>

```{r populacao-amostra, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática da amostragem: seleção de uma população para a amostra."}
library(dplyr)

# Reprodutibilidade
set.seed(123)

# Dados da população e amostra
pop_n <- 50
sample_n <- 10

# Reduzindo os raios internos para posicionar os ícones mais perto do centro
radius_pop <- runif(pop_n, 0.5, 2.5)
radius_sample <- runif(sample_n, 0.5, 1.5)

# Geração das posições para a população (círculo à esquerda)
angle_pop <- seq(0, 2 * pi, length.out = pop_n + 1)[-1]
pop_df <- data.frame(
  id = 1:pop_n,
  x_pop = cos(angle_pop) * radius_pop - 4,
  y_pop = sin(angle_pop) * radius_pop
)

# Seleção aleatória da amostra
sample_ids <- sample(pop_df$id, sample_n)
sample_df <- pop_df %>%
  dplyr::filter(id %in% sample_ids) %>%
  dplyr::mutate(
    angle = seq(0, 2 * pi, length.out = sample_n + 1)[-1],
    x_sample = cos(angle) * radius_sample + 4,
    y_sample = sin(angle) * radius_sample
  )

# Atribui o ícone após os data.frames estarem prontos
pop_df$label <- "./images/person.svg"
sample_df$label <- "./images/person.svg"

# Base de setas
setas_df <- sample_df %>%
  dplyr::select(id, x_pop, y_pop, x_sample, y_sample)

# Plot
ggplot2::ggplot() +
  # Círculo da população
  ggforce::geom_circle(ggplot2::aes(x0 = -4, y0 = 0, r = 3),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = pop_df,
                      ggplot2::aes(x = x_pop, y = y_pop, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = -4,
    y = 3.5,
    label = "População",
    size = 5,
    fontface = "bold"
  ) +
  
  # Círculo da amostra
  ggforce::geom_circle(ggplot2::aes(x0 = 4, y0 = 0, r = 1.8),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(
    data = sample_df,
    ggplot2::aes(x = x_sample, y = y_sample, image = label),
    size = 0.07
  ) +
  ggplot2::annotate(
    "text",
    x = 4,
    y = 2.3,
    label = "Amostra",
    size = 5,
    fontface = "bold"
  ) +
  # Setas
  ggplot2::geom_curve(
    data = setas_df,
    ggplot2::aes(
      x = x_pop,
      y = y_pop,
      xend = x_sample,
      yend = y_sample
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "darkgray",
    linewidth = 0.7,
    curvature = -0.2
  ) +
  ggplot2::coord_fixed() +
  ggplot2::theme_void() +
  # Texto "Amostragem"
  ggplot2::annotate(
    "text",
    x = 0,
    y = 3,
    label = "Amostragem",
    color = "darkgray",
    size = 5,
    fontface = "italic"
  )
```

<br>

### Quais métodos de amostragem são usados para obter uma amostra da população?

-   O método de amostragem é geralmente definido pelas condições de viabilidade do estudo, no que diz respeito a acesso aos participantes, ao tempo de execução e aos custos envolvidos, entre outras.[@Banerjee2010]

-   Não-probabilísticas ou intencionais:[@Banerjee2010; @martínez-mesa2016]

    - Bola de neve.

    - Conveniência.

    - Participantes encaminhados.
    
    - Proposital.

-   Probabilísticas:[@Banerjee2010; @martínez-mesa2016]

    - Simples.

    - Sistemática.

    - Multiestágio.

    - Estratificada.

    - Agregada.

<br>

### O que é erro de amostragem?

- Erro de amostragem é a variação natural entre os resultados obtidos a partir de uma amostra e os resultados que seriam obtidos caso toda a população fosse examinada. Reflete o grau de incerteza inerente à generalização de uma amostra para a população.[@martínez-mesa2016]

<br>

```{r erro-amostragem-esquematico, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática do erro de amostragem: seleção de várias amostras independentes de uma população."}
# Reprodutibilidade
set.seed(123)

# parâmetros
pop_n <- 80       # tamanho da população
sample_n <- 12    # tamanho de cada amostra
n_amostras <- 5   # número de amostras
svg_size <- 0.035

# --- População ---
radius_pop <- runif(pop_n, 0.5, 2.5)
angle_pop <- seq(0, 2*pi, length.out = pop_n + 1)[-1]
pop_df <- data.frame(
  id = 1:pop_n,
  x_pop = cos(angle_pop) * radius_pop - 6,
  y_pop = sin(angle_pop) * radius_pop,
  label = "./images/person.svg"
)

# --- Amostras independentes ---
offsets <- seq(6, -6, length.out = n_amostras)  # posições verticais para separar círculos
lista_amostras <- lapply(seq_len(n_amostras), function(i){
  ids <- sample(pop_df$id, sample_n)
  radius <- runif(sample_n, 0.2, 0.8)
  angle <- seq(0, 2*pi, length.out = sample_n+1)[-1]
  tibble::tibble(
    amostra = paste0("Amostra ", i),
    id = ids,
    x = cos(angle) * radius + 6,
    y = sin(angle) * radius + offsets[i],
    label = "./images/person.svg"
  )
})
amostras_df <- dplyr::bind_rows(lista_amostras)

# círculos das amostras
circulos_amostras <- data.frame(
  x0 = 6,
  y0 = offsets,
  r = 1.0,
  amostra = paste0("Amostra ", 1:n_amostras)
)

# --- Setas População → Amostras ---
setas <- dplyr::inner_join(
  dplyr::select(pop_df, id, x_pop, y_pop),
  dplyr::select(amostras_df, id, amostra, x, y),
  by = "id"
) %>%
  dplyr::rename(xend = x, yend = y, x = x_pop, y = y_pop)

# --- Gráfico ---
ggplot2::ggplot() +
  # círculo população
  ggforce::geom_circle(ggplot2::aes(x0 = -6, y0 = 0, r = 3), color = "black") +
  ggimage::geom_image(data = pop_df, ggplot2::aes(x = x_pop, y = y_pop, image = label), size = svg_size) +
  ggplot2::annotate("text", x = -6, y = 3.5, label = "População", fontface = "bold", size = 5) +
  
  # círculos das amostras
  ggforce::geom_circle(data = circulos_amostras, ggplot2::aes(x0 = x0, y0 = y0, r = r), color = "black") +
  ggimage::geom_image(data = amostras_df, ggplot2::aes(x = x, y = y, image = label), size = svg_size) +
  ggplot2::geom_text(data = circulos_amostras,
            ggplot2::aes(x = x0, y = y0 + r + 0.4, label = amostra),
            fontface = "bold", size = 4) +
  
  # setas
  ggplot2::geom_curve(data = setas,
             ggplot2::aes(x = x, y = y, xend = xend, yend = yend),
             arrow = ggplot2::arrow(length = grid::unit(0.18, "cm")),
             color = "gray50", curvature = -0.2, linewidth = 0.6) +
  
  ggplot2::coord_fixed() +
  ggplot2::theme_void()
```

<br>

```{r erro-amostragem, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática da amostragem de uma população para a amostra."}
# Reprodutibilidade
set.seed(123)

# ----- 1) Defina população e parâmetros -----
N <- 1000          # tamanho da população
mu <- 50           # média "verdadeira" para gerar a população
sd_pop <- 10       # desvio-padrão populacional usado na geração
n <- 30            # tamanho de cada amostra
n_amostras <- 5    # número de amostras independentes

# População fixa (a "verdade" do experimento)
pop <- tibble::tibble(
  id = 1:N,
  valor = rnorm(N, mean = mu, sd = sd_pop)
)

mu_pop <- mean(pop$valor)
sd_pop_emp <- sd(pop$valor)

# ----- 2) Desenhe 5 amostras independentes desta mesma população -----
amostras <- purrr::map_dfr(1:n_amostras, function(i) {
  idx <- sample(pop$id, n, replace = FALSE)  # SRS sem reposição
  tibble::tibble(
    amostra = paste0("Amostra ", i),
    id = idx
  ) %>%
    dplyr::left_join(pop, by = "id")
})

# Resumo das amostras: média, EP e erro em relação à média populacional
resumo <- amostras %>%
  dplyr::group_by(amostra) %>%
  dplyr::summarise(
    n = n(),
    media = mean(valor),
    sd_amostra = sd(valor),
    EP = sd_amostra / sqrt(n),
    erro = media - mu_pop,
    .groups = "drop"
  )

# ----- 3) GRÁFICO 1: População (densidade) + 5 amostras em "tapetes" -----
# Mapeamos cada amostra para uma faixa no eixo Y (fator numérico) e exibimos:
# - densidade da população (cinza, ao fundo)
# - pontos das observações de cada amostra (jitter)
# - linha vertical da média populacional
# - linha vertical da média de cada amostra

amostras$nivel <- as.numeric(factor(amostras$amostra))  # 1..5

g1 <- ggplot2::ggplot() +
  # densidade da população ao fundo
  ggplot2::geom_density(data = pop, ggplot2::aes(x = valor, y = ggplot2::after_stat(scaled)),
               fill = "grey80", alpha = 0.7) +
  # jitter de pontos por amostra (deslocados no Y)
  ggplot2::geom_point(data = amostras,
             ggplot2::aes(x = valor, y = nivel),
             position = ggplot2::position_jitter(height = 0.08), size = 1.3, alpha = 0.75) +
  # linha da média populacional
  ggplot2::geom_vline(xintercept = mu_pop, linetype = 2, linewidth = 0.7) +
  # linhas das médias de cada amostra
  ggplot2::geom_segment(data = resumo,
               ggplot2::aes(x = media, xend = media,
                   y = as.numeric(factor(amostra)) - 0.35,
                   yend = as.numeric(factor(amostra)) + 0.35),
               linewidth = 1) +
  ggplot2::scale_y_continuous(
    breaks = unique(amostras$nivel),
    labels = levels(factor(amostras$amostra))
  ) +
  ggplot2::labs(
    title = "Mesma população → amostras diferentes",
    subtitle = sprintf("Cada amostra tem sua própria média", mu_pop),
    x = "Valor",
    y = NULL
  ) +
  ggplot2::theme_minimal(base_size = 12)

# Imprimir resultados
print(g1)
```

<br>

## Reamostragem

<br>

### O que é reamostragem?

-   Reamostragem é um procedimento que cria vários conjuntos de dados sorteados a partir de um conjunto de dados real - a amostra da população - sem a necessidade de fazer suposições sobre os dados e suas distribuições.[@Bland2015]

-   O procedimento é repetido várias vezes para usar a variabilidade dos resultados para obter um intervalo de confiança do parâmetro no nível de significância $\alpha$ pré-estabelecido.[@Bland2015]

<br>

### Por que utilizar reamostragem?

-   Quando se dispõe de dados de apenas 1 amostra, as diversas suposições que são feitas podem não ser atingidas.[@Bland2015]

-   Procedimentos de reamostragem produzem um conjunto de observações escolhidas aleatoriamente da amostra, igualmente representativo da população original.[@Bland2015]

-   Procedimentos de reamostragem permitem estimar o erro-padrão e intervalos de confiança sem a necessidade de tais suposições, sendo, portanto, um conjunto de procedimentos não-paramétricos.[@Bland2015]

<br>

### Quais procedimentos de reamostragem podem ser realizados?

-   *Bootstrap*: Cada iteração gera uma amostra *bootstrap* do mesmo tamanho do conjunto de dados original escolhendo aleatoriamente observações reais, uma de cada vez. Cada observação tem chances iguais de ser escolhida a cada vez, portanto, algumas observações serão escolhidas mais de uma vez e outras nem serão escolhidas.[@Bland2015]

<br>

```{r reamostragem, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática da reamostragem de uma amostra."}
# reproducibilidade
set.seed(123)

# parâmetros
pop_n <- 50
sample_n <- 10
svg_size <- 0.045
y_offsets <- c(6, 3, 0, -3, -6)
raio_reamostra <- 1.2

# População (coluna 1)
radius_pop <- runif(pop_n, 0.5, 2.5)
angle_pop <- seq(0, 2 * pi, length.out = pop_n + 1)[-1]
pop_df <- data.frame(
  id = 1:pop_n,
  x_pop = cos(angle_pop) * radius_pop - 6,
  y_pop = sin(angle_pop) * radius_pop,
  label = "./images/person.svg"
)

# Amostra (coluna 2)
radius_sample <- runif(sample_n, 0.4, 1.2)
angle_sample <- seq(0, 2 * pi, length.out = sample_n + 1)[-1]
sample_ids <- sample(pop_df$id, sample_n)
sample_df <- dplyr::filter(pop_df, id %in% sample_ids) |>
  dplyr::mutate(
    angle = angle_sample,
    x_sample = cos(angle) * radius_sample,
    y_sample = sin(angle) * radius_sample,
    label = "./images/person.svg"
  )

# Reamostras (coluna 3) — agora bootstrap da amostra
reamostra_list <- lapply(seq_along(y_offsets), function(i) {
  offset <- y_offsets[i]
  radius_sample <- runif(sample_n, 0.3, 1.1)
  angle_sample <- seq(0, 2 * pi, length.out = sample_n + 1)[-1]
  
  # Bootstrap da amostra: sorteia com reposição
  re_ids <- sample(sample_df$id, sample_n, replace = TRUE)
  sample_boot <- dplyr::filter(sample_df, id %in% re_ids)
  
  # Para manter mesmo número de pontos, atribuímos posições sequenciais
  sample_boot <- dplyr::arrange(sample_boot, id)[seq_len(sample_n), ] |>
    dplyr::mutate(
      angle = angle_sample,
      x_sample_reamostra = cos(angle) * radius_sample + 6,
      y_sample_reamostra = sin(angle) * radius_sample + offset,
      grupo = paste0("Reamostra ", i)
    )
})
reamostras_df <- dplyr::bind_rows(reamostra_list)

# Setas: População → Amostra
setas_amostra <- dplyr::left_join(
  dplyr::filter(pop_df, id %in% sample_ids),
  dplyr::select(sample_df, id, xend = x_sample, yend = y_sample),
  by = "id"
) |>
  dplyr::rename(x = x_pop, y = y_pop)

# Setas: Amostra → Reamostras (AGORA COMPLETO)
# Faz um join entre a amostra e todas as ocorrências nas reamostras.
setas_reamostras <- dplyr::inner_join(
  dplyr::select(sample_df, id, x_amostra = x_sample, y_amostra = y_sample),
  dplyr::select(
    reamostras_df,
    id,
    x_sample_reamostra,
    y_sample_reamostra,
    grupo
  ),
  by = "id"
) |>
  dplyr::rename(x = x_amostra,
                y = y_amostra,
                xend = x_sample_reamostra,
                yend = y_sample_reamostra)


# Gráfico
ggplot2::ggplot() +
  # Coluna População
  ggforce::geom_circle(ggplot2::aes(x0 = -6, y0 = 0, r = 3),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = pop_df,
                      ggplot2::aes(x = x_pop, y = y_pop, image = label),
                      size = svg_size) +
  ggplot2::annotate(
    "text",
    x = -6,
    y = 3.5,
    label = "População",
    size = 5,
    fontface = "bold"
  ) +
  # Coluna Amostra
  ggforce::geom_circle(ggplot2::aes(x0 = 0, y0 = 0, r = 1.8),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(
    data = sample_df,
    ggplot2::aes(x = x_sample, y = y_sample, image = label),
    size = svg_size
  ) +
  ggplot2::annotate(
    "text",
    x = 0,
    y = 2.3,
    label = "Amostra",
    size = 5,
    fontface = "bold"
  ) +
  # Coluna Reamostras
  ggforce::geom_circle(
    data = data.frame(x0 = 6, y0 = y_offsets, r = raio_reamostra),
    ggplot2::aes(x0 = x0, y0 = y0, r = r),
    color = "black",
    linewidth = 1
  ) +
  ggimage::geom_image(
    data = reamostras_df,
    ggplot2::aes(x = x_sample_reamostra, y = y_sample_reamostra, image = label),
    size = svg_size
  ) +
  ggplot2::geom_text(
    data = data.frame(
      x = 6,
      y = y_offsets,
      label = paste0("Reamostra ", 1:5)
    ),
    ggplot2::aes(
      x = x,
      y = y + raio_reamostra + 0.4,
      label = label
    ),
    size = 4.2,
    fontface = "bold"
  ) +
  # Setas: População → Amostra
  ggplot2::geom_curve(
    data = setas_amostra,
    ggplot2::aes(
      x = x,
      y = y,
      xend = xend,
      yend = yend
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "gray50",
    linewidth = 0.6,
    curvature = -0.2
  ) +
  # Setas: Amostra → Reamostras
  ggplot2::geom_curve(
    data = setas_reamostras,
    ggplot2::aes(
      x = x,
      y = y,
      xend = xend,
      yend = yend
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "gray60",
    linewidth = 0.6,
    curvature = -0.2
  ) +
  ggplot2::theme_void()
```

<br>

## Subamostragem

<br>

### O que é subamostragem?

-   .[@REF]

<br>

```{r subamostragem, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática da subamostragem de uma amostra."}
# Reprodutibilidade
set.seed(123)

# Tamanhos
pop_n <- 50
sample_n <- 15
subsample_n <- 5

# Raio dos círculos
radius_pop <- runif(pop_n, 0.5, 2.5)
radius_sample <- runif(sample_n, 0.5, 1.5)
radius_subsample <- runif(subsample_n, 0.5, 1)

# Ângulos para posicionamento circular
angle_pop <- seq(0, 2 * pi, length.out = pop_n + 1)[-1]
angle_sample <- seq(0, 2 * pi, length.out = sample_n + 1)[-1]
angle_subsample <- seq(0, 2 * pi, length.out = subsample_n + 1)[-1]

# População (esquerda)
pop_df <- data.frame(
  id = 1:pop_n,
  x_pop = cos(angle_pop) * radius_pop - 6,
  y_pop = sin(angle_pop) * radius_pop,
  label = "./images/person.svg"
)

# Amostra (centro)
sample_ids <- sample(pop_df$id, sample_n)
sample_df <- pop_df %>%
  dplyr::filter(id %in% sample_ids) %>%
  dplyr::mutate(
    angle = angle_sample,
    x_sample = cos(angle_sample) * radius_sample,
    y_sample = sin(angle_sample) * radius_sample,
    label = "./images/person.svg"
  )

# Subamostra (direita)
subsample_ids <- sample(sample_df$id, subsample_n)
subsample_df <- sample_df %>%
  dplyr::filter(id %in% subsample_ids) %>%
  dplyr::mutate(
    angle = angle_subsample,
    x_sub = cos(angle_subsample) * radius_subsample + 6,
    y_sub = sin(angle_subsample) * radius_subsample,
    label = "./images/person.svg"
  )

# Setas população → amostra
setas_1 <- sample_df %>%
  dplyr::select(id, x_pop, y_pop, x_sample, y_sample)

# Setas amostra → subamostra
setas_2 <- subsample_df %>%
  dplyr::select(id, x_sample, y_sample, x_sub, y_sub)

# Plot
ggplot2::ggplot() +
  # Círculo da população
  ggforce::geom_circle(ggplot2::aes(x0 = -6, y0 = 0, r = 3),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = pop_df,
                      ggplot2::aes(x = x_pop, y = y_pop, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = -6,
    y = 3.5,
    label = "População",
    size = 5,
    fontface = "bold"
  ) +
  # Círculo da amostra
  ggforce::geom_circle(ggplot2::aes(x0 = 0, y0 = 0, r = 2),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = sample_df,
                      ggplot2::aes(x = x_sample, y = y_sample, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = 0,
    y = 2.5,
    label = "Amostra",
    size = 5,
    fontface = "bold"
  ) +
  # Círculo da subamostra
  ggforce::geom_circle(ggplot2::aes(x0 = 6, y0 = 0, r = 1.2),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = subsample_df,
                      ggplot2::aes(x = x_sub, y = y_sub, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = 6,
    y = 1.7,
    label = "Subamostra",
    size = 5,
    fontface = "bold"
  ) +
  # Setas: população → amostra
  ggplot2::geom_curve(
    data = setas_1,
    ggplot2::aes(
      x = x_pop,
      y = y_pop,
      xend = x_sample,
      yend = y_sample
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "darkgray",
    linewidth = 0.7,
    curvature = -0.2
  ) +
  # Setas: amostra → subamostra
  ggplot2::geom_curve(
    data = setas_2,
    ggplot2::aes(
      x = x_sample,
      y = y_sample,
      xend = x_sub,
      yend = y_sub
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "darkgray",
    linewidth = 0.7,
    curvature = 0.2
  ) +
  ggplot2::coord_fixed() +
  ggplot2::theme_void()
```

<br>

## Superamostragem

<br>

### O que é superamostragem?

-   .[@REF]

<br>

```{r superamostragem, echo = FALSE, warning = FALSE, message = FALSE, appendix = TRUE, fig.align = 'center', layout='Blank', ph=officer::ph_location_fullsize(), results = "asis", fig.fullwidth = TRUE, fig.cap = "Representação esquemática da superamostragem de uma população."}
# Reprodutibilidade
set.seed(123)

# Tamanhos
pop_n <- 50
sample_n <- 15
supersample_n <- 30  # maior que a amostra

# Raio dos círculos
radius_pop <- runif(pop_n, 0.5, 2.5)
radius_sample <- runif(sample_n, 0.5, 1.5)

# Ângulos para população e amostra
angle_pop <- seq(0, 2 * pi, length.out = pop_n + 1)[-1]
angle_sample <- seq(0, 2 * pi, length.out = sample_n + 1)[-1]

# População (esquerda)
pop_df <- data.frame(
  id = 1:pop_n,
  x_pop = cos(angle_pop) * radius_pop - 6,
  y_pop = sin(angle_pop) * radius_pop,
  label = "./images/person.svg"
)

# Amostra (centro) – amostragem aleatória da população
sample_ids <- sample(pop_df$id, sample_n)
sample_df <- pop_df %>%
  dplyr::filter(id %in% sample_ids) %>%
  dplyr::mutate(
    angle = angle_sample,
    x_sample = cos(angle_sample) * radius_sample,
    y_sample = sin(angle_sample) * radius_sample,
    label = "./images/person.svg"
  )

# Superamostra (direita) – reamostragem com reposição da amostra
angle_supersample <- seq(0, 2 * pi, length.out = supersample_n + 1)[-1]
radius_supersample <- runif(supersample_n, 0.5, 1)

supersample_df <- sample_df %>%
  dplyr::slice_sample(n = supersample_n, replace = TRUE) %>%
  dplyr::mutate(
    angle = angle_supersample,
    radius = radius_supersample,
    x_sub = cos(angle) * radius + 6,
    y_sub = sin(angle) * radius,
    label = "./images/person.svg"
  )

# Setas população → amostra
setas_1 <- sample_df %>%
  dplyr::select(id, x_pop, y_pop, x_sample, y_sample)

# Setas amostra → superamostra
setas_2 <- supersample_df %>%
  dplyr::select(id, x_sample, y_sample, x_sub, y_sub)

# Plot
ggplot2::ggplot() +
  # Círculo da população
  ggforce::geom_circle(ggplot2::aes(x0 = -6, y0 = 0, r = 3),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = pop_df,
                      ggplot2::aes(x = x_pop, y = y_pop, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = -6,
    y = 3.5,
    label = "População",
    size = 5,
    fontface = "bold"
  ) +
  # Círculo da amostra
  ggforce::geom_circle(ggplot2::aes(x0 = 0, y0 = 0, r = 2),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = sample_df,
                      ggplot2::aes(x = x_sample, y = y_sample, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = 0,
    y = 2.5,
    label = "Amostra",
    size = 5,
    fontface = "bold"
  ) +
  # Círculo da superamostra
  ggforce::geom_circle(ggplot2::aes(x0 = 6, y0 = 0, r = 2.3),
                       color = "black",
                       linewidth = 1) +
  ggimage::geom_image(data = supersample_df,
                      ggplot2::aes(x = x_sub, y = y_sub, image = label),
                      size = 0.07) +
  ggplot2::annotate(
    "text",
    x = 6,
    y = 2.8,
    label = "Superamostra",
    size = 5,
    fontface = "bold"
  ) +
  # Setas: população → amostra
  ggplot2::geom_curve(
    data = setas_1,
    ggplot2::aes(
      x = x_pop,
      y = y_pop,
      xend = x_sample,
      yend = y_sample
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "darkgray",
    linewidth = 0.7,
    curvature = -0.2
  ) +
  # Setas: amostra → superamostra
  ggplot2::geom_curve(
    data = setas_2,
    ggplot2::aes(
      x = x_sample,
      y = y_sample,
      xend = x_sub,
      yend = y_sub
    ),
    arrow = ggplot2::arrow(length = grid::unit(0.2, "cm")),
    color = "darkgray",
    linewidth = 0.7,
    curvature = 0.2
  ) +
  ggplot2::coord_fixed() +
  ggplot2::theme_void()
```

<br>

```{r, echo=FALSE, warning=FALSE, results='asis', eval=knitr::is_html_output()}
cat(readLines("citation.html"), sep = "\n")
```

<br>
