# **Unidade de análise** {#unidade-analise}

<br>

## Definição {#definicao}

<br>

### O que é unidade de análise?

-   A unidade de análise (ou unidade experimental) de pesquisas na área de saúde geralmente é o indivíduo.[@Altman1997]

-   A unidade de análise também pode ser a instituição em estudos multicêntricos (ex.: hospitais, clínicas) ou um estudo publicado em meta-análise (ex.: ensaios clínicos).[@Altman1997]

-   É fundamental identificar corretamente a unidade de análise para evitar inflação do tamanho da amostra (ex.: medidas bilaterais resultando em o dobro de participantes), violações de suposições dos testes de hipótese (ex.: independência entre medidas e/ou unidade de análise) e resultados espúrios em testes de hipótese (ex.: p-valores menores que aqueles observados se a amostra não estivesse inflada).[@Altman1997; @Matthews1990]

<br>

## Medidas únicas ou múltiplas {#medidas}

<br>

### Como podem ser coletadas as informações da unidade de análise?

-   Da unidade de análise podem ser coletadas informações em medidas únicas, repetidas, seriadas ou múltiplas.

<br>

#### Medidas únicas

```{r k1, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "hide"}
# sorteia participante para relatar no texto
set.seed(1)
k1 <- sample(1:10, 1)
```

```{r medidas-unicas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(1)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# sorteia n dados no intervalo min-max, com reposição para cada variável
VAR.1 <- sample(inferior:superior, n, replace = TRUE)

# organiza as informações de unidade de análise e dados
table.1 <- data.frame(ID, VAR.1)

# atribui rótulos para a tabela de dados
colnames(table.1) <-
  c("Unidade de análise", "Pressão arterial, braço esquerdo (mmHg)")

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.1, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas únicas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(k1, background = "#E6E6E6", bold = TRUE)
```

-   A medida única da pressão arterial sistólica no braço esquerdo resulta em um valor pontual. O valor pontual será considerado representativo da variável para a unidade de análise (ex.: **`r VAR.1[k1]` mmHg** para o participante **\#`r k1`**). Medidas únicas obtidas de diferentes unidades de análise podem ser consideradas independentes se observadas outras condições na coleta de dados.

<br>

```{r medidas-unicas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

<br>

#### Medidas repetidas

```{r k2, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "hide"}
# sorteia participante para relatar no texto
set.seed(2)
k2 <- sample(1:10, 1)
```

```{r medidas-repetidas-separadas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(2)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# sorteia n dados no intervalo min-max, com reposição para cada variável
VAR.1 <- sample(inferior:superior, n, replace = TRUE)
VAR.2 <- sample(inferior:superior, n, replace = TRUE)
VAR.3 <- sample(inferior:superior, n, replace = TRUE)

# organiza as informações de unidade de análise e dados
VAR <- data.frame(VAR.1, VAR.2, VAR.3)
table.2 <- data.frame(ID, VAR)

# atribui rótulos para a tabela de dados
colnames(table.2) <-
  c(
    "Unidade de análise",
    "Pressão arterial, braço esquerdo (mmHg) #1",
    "Pressão arterial, braço esquerdo (mmHg) #2",
    "Pressão arterial, braço esquerdo (mmHg) #3"
  )

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.2, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas repetidas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(k2, background = "#E6E6E6", bold = TRUE)
```

-   A medida repetida da pressão arterial no braço esquerdo, resultando em um conjunto de valores pontuais (ex.: **`r VAR.1[k2]` mmHg**, **`r VAR.2[k2]` mmHg** e **`r VAR.3[k2]` mmHg** para o participante **\#`r k2`**). As medidas repetidas podem ser tabuladas separadamente, por exemplo para análise da confiabilidade de obtenção dessa medida.

<br>

```{r medidas-repetidas-separadas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

```{r medidas-repetidas-agregadas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(2)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# sorteia n dados no intervalo min-max, com reposição para cada variável
VAR.1 <- sample(inferior:superior, n, replace = TRUE)
VAR.2 <- sample(inferior:superior, n, replace = TRUE)
VAR.3 <- sample(inferior:superior, n, replace = TRUE)

# organiza as informações de unidade de análise e dados
VAR <- data.frame(VAR.1, VAR.2, VAR.3)

# converte dados para variável numérica contínua
VAR <- sapply(VAR, as.numeric)

# agrega os valores repetidos em linhas com a média
VAR.aggr <- apply(VAR, 1, FUN = mean)

# organiza as informações de unidade de análise e dados
table.3 <- data.frame(ID, VAR.aggr)

# formata a visualzação de casas decimais das variáveis numéricas
table.3 <- format(table.3, nsmall = 0)

# atribui rótulos para a tabela de dados
colnames(table.3) <-
  c("Unidade de análise",
    "Pressão arterial, braço esquerdo (mmHg) média")

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.3, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas repetidas agregadas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(k2, background = "#E6E6E6", bold = TRUE)
```

<br>

-   As medidas repetidas podem ser agregadas por algum parâmetro --- ex.: média, mediana, máximo, mínimo, entre outros---, observando-se a relevância biológica, clínica e/ou metodológica desta escolha. O valor agregado será considerado representativo da variável para a unidade de análise (ex.: média = **`r round(VAR.aggr[k2], digits = 0)` mmHg** para o participante **\#`r k2`**). Medidas agregadas obtidas de diferentes unidades de análise podem ser consideradas independentes se observadas outras condições na coleta de dados.

<br>

```{r medidas-repetidas-agregadas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

<br>

::: {style="color: blue;"}
`r library(fontawesome); fa("r-project", margin_right = "0.1em")` O pacote *stats*[@stats-2] fornece a função *aggregate* para agregar medidas repetidas utilizando uma função. [`r library(fontawesome); fa("up-right-from-square", margin_right = "0.1em")`](https://rdocumentation.org/packages/stats/versions/3.6.2)
:::

<br>

#### Medidas seriadas

```{r k3, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "hide"}
# sorteia participante para relatar no texto
set.seed(2)
k2 <- sample(1:10, 1)
```

```{r medidas-seriadas-separadas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(3)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# número de medidas seriadas
k <- 3

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# prepara a tabela de resultados
table.4 <-
  data.frame(matrix(
    vector(),
    nrow = 0,
    ncol = 3,
    dimnames = list(
      c(),
      c(
        "Unidade de análise",
        "Tempo (min)",
        "Pressão arterial, braço esquerdo (mmHg)"
      )
    )
  ))

# para cada série
for (i in 1:k) {
  # cria o fator de repetição seriada
  TIME <- rep(i, n)
  
  # sorteia n dados no intervalo min-max, com reposição para cada variável
  VAR <- sample(inferior:superior, n, replace = TRUE)
  
  # organiza as informações de unidade de análise e dados
  serie <- data.frame(ID, TIME, VAR)
  
  # atribui rótulos para a tabela de dados
  colnames(serie) <-
    c("Unidade de análise",
      "Tempo (min)",
      "Pressão arterial, braço esquerdo (mmHg)")
  
  # concatena as informações de unidade de análise e dados para cada série de coleta
  table.4 <- rbind(table.4, serie)
}

# reordena a tabela de dados
table.4 <-
  table.4[order(table.4[, 1], table.4[, 2], decreasing = FALSE),]

# atribui rótulos para a tabela de dados
colnames(table.4) <-
  c("Unidade de análise",
    "Tempo (min)",
    "Pressão arterial, braço esquerdo (mmHg)")

# remove rótulos para as linhas
row.names(table.4) <- NULL

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.4, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas seriadas não agregadas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(1:3, background = "#E6E6E6", bold = TRUE)
```

<br>

-   Medidas seriadas são possivelmente relacionadas e, portanto, dependentes na mesma unidade de análise. Por exemplo, a medida seriada da pressão arterial no braço esquerdo, em intervalos tipicamente regulares (ex.: **`r table.4[1,3]` mmHg**, **`r table.4[2,3]` mmHg** e **`r table.4[3,3]` mmHg** em **`r 1` min**, **`r 2` min** e **`r 3` min**, respectivamente, para o participante **#1**).

<br>

```{r medidas-seriadas-separadas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

```{r medidas-seriadas-agregadas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(3)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# número de medidas seriadas
k <- 3

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# prepara a tabela de resultados
table.5 <-
  data.frame(matrix(
    vector(),
    nrow = 0,
    ncol = 3,
    dimnames = list(
      c(),
      c(
        "Unidade de análise",
        "Tempo (min)",
        "Pressão arterial, braço esquerdo (mmHg)"
      )
    )
  ))

# para cada série
for (i in 1:k) {
  # cria o fator de repetição seriada
  TIME <- rep(i, n)
  
  # sorteia n dados no intervalo min-max, com reposição para cada variável
  VAR <- sample(inferior:superior, n, replace = TRUE)
  
  # organiza as informações de unidade de análise e dados
  serie <- data.frame(ID, TIME, VAR)
  
  # atribui rótulos para a tabela de dados
  colnames(serie) <-
    c("Unidade de análise",
      "Tempo (min)",
      "Pressão arterial, braço esquerdo (mmHg)")
  
  # concatena as informações de unidade de análise e dados para cada série de coleta
  table.5 <- rbind(table.5, serie)
}

# converte dados para variável numérica contínua
table.5[, 3] <- sapply(table.5[, 3], as.numeric)

# agrega os valores seriados em linhas com a amplitude
table.5 <-
  aggregate(
    table.5[, 3] ~ table.5[, 1],
    FUN = function(x) {
      range(x)[2] - range(x)[1]
    }
  )

# formata a visualzação de casas decimais das variáveis numéricas
table.5 <- format(table.5, nsmall = 0)

# atribui rótulos para a tabela de dados
colnames(table.5) <-
  c("Unidade de análise",
    "Pressão arterial, braço esquerdo (mmHg) amplitude")

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.5, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas seriadas não agregadas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(1, background = "#E6E6E6", bold = TRUE)
```

<br>

-   Medidas seriadas também agregadas por parâmetros --- ex.: máximo, mínimo, amplitude --- são consideradas representativas da variação temporal ou de uma característica de interesse (ex.: amplitude = **`r table.5[1,2]` mmHg** para o participante **#1**).

<br>

```{r medidas-seriadas-agregadas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

<br>

::: {style="color: blue;"}
`r library(fontawesome); fa("r-project", margin_right = "0.1em")` O pacote *stats*[@stats-2] fornece a função *aggregate* para agregar medidas repetidas utilizando uma função. [`r library(fontawesome); fa("up-right-from-square", margin_right = "0.1em")`](https://rdocumentation.org/packages/stats/versions/3.6.2)
:::

<br>

#### Medidas múltiplas

```{r k4, include = FALSE, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "hide"}
# sorteia participante para relatar no texto
set.seed(4)
k4 <- sample(1:10, 1)
```

```{r medidas-multiplas, include = FALSE, echo = FALSE, results = "hide"}
# para reprodutibilidade das simulações
set.seed(4)

# tamanho do grupo
n <- 100

# cria o fator unidade de análise, sem reposição
ID <- seq(1:n)

# determina os limites do espaço amostral para sorteio
inferior <- 110
superior <- 120

# sorteia n dados no intervalo min-max, com reposição para cada variável
VAR.1 <- sample(inferior:superior, n, replace = TRUE)
VAR.2 <- sample(inferior:superior, n, replace = TRUE)

# organiza as informações de unidade de análise e dados
VAR <- data.frame(VAR.1, VAR.2)
table.6 <- data.frame(ID, VAR)

# atribui rótulos para a tabela de dados
colnames(table.6) <-
  c(
    "Unidade de análise",
    "Pressão arterial, braço esquerdo (mmHg)",
    "Pressão arterial, braço direito (mmHg)"
  )

# exibe as 10 linhas iniciais da tabela de dados
kableExtra::kable(
  head(table.6, n = 10L),
  align = "c",
  format = ifelse(knitr::is_html_output(), "html", "latex"),
  booktabs = TRUE,
  linesep = "",
  caption = "Tabela de dados bruto com medidas múltiplas."
) %>%
  kableExtra::kable_styling(
    latex_options = c("striped"),
    bootstrap_options = c("striped", "hover", "condensed", "responsive"),
    full_width = ifelse(knitr::is_html_output(), T, T),
    position = "center"
  ) %>%
  kableExtra::row_spec(0,
                       bold = TRUE,
                       extra_css = "border-top: 1px solid; border-bottom: 1px solid") %>%
  kableExtra::row_spec(10,
                       extra_css = "border-bottom: 1px solid") %>%
  kableExtra::row_spec(k4, background = "#E6E6E6", bold = TRUE)
```

-   A medida de pressão arterial bilateral resulta em um conjunto de valores pontuais (ex.: braço esquerdo = **`r round(VAR.1[k4], digits = 0)` mmHg**, braço direito = **`r round(VAR.2[k4], digits = 0)` mmHg** para o participante **\#`r k4`**). Neste caso, ambos os valores pontuais são considerados representativos daquela unidade de análise. Medidas múltiplas também são possivelmente relacionadas e, portanto, são dependentes na mesma unidade de análise. Medidas múltiplas podem ser obtidas de modo repetido para análise agregada ou seriada.

<br>

```{r medidas-multiplas, echo = FALSE, warning = FALSE, message = FALSE, fig.align = 'center', results = "asis"}
```

<br>

::: {style="color: blue;"}
`r library(fontawesome); fa("r-project", margin_right = "0.1em")` O pacote *stats*[@stats-2] fornece a função *aggregate* para agregar medidas repetidas utilizando uma função. [`r library(fontawesome); fa("up-right-from-square", margin_right = "0.1em")`](https://rdocumentation.org/packages/stats/versions/3.6.2)
:::

<br>
